import os
import re
from datetime import datetime, timedelta

# Define the directory where your folders are located
directory_path = '/path/to/your/directory'

# Get the current date
current_date = datetime.now()

# Calculate the date three months ago from the current date
three_months_ago = current_date - timedelta(days=90)

# Define the regex pattern for folder names (YYYYMMDD format)
folder_name_pattern = r'^\d{8}$'

# Compile the regex pattern for folder names
folder_pattern = re.compile(folder_name_pattern)

# Generate a list of dates for the last three months
date_list = [three_months_ago + timedelta(days=i) for i in range(91)]

# Initialize variables to store the latest and latest-1 folder names
latest_folder = None
latest_minus_1_folder = None

# Iterate through the generated dates and check if the corresponding folder exists
for date in date_list:
    folder_name = date.strftime('%Y%m%d')
    folder_path = os.path.join(directory_path, folder_name)
    
    # Check if the folder exists
    if os.path.exists(folder_path) and os.path.isdir(folder_path):
        # Define the regex pattern for file names with the captured date
        file_name_pattern = rf'^file_name_{folder_name}_latest\.csv$'
        
        # Compile the regex pattern for file names
        pattern = re.compile(file_name_pattern)
        
        # Iterate through the files in the folder and check if the pattern matches
        for filename in os.listdir(folder_path):
            if pattern.match(filename):
                if latest_folder is None:
                    latest_folder = folder_name
                else:
                    latest_minus_1_folder = folder_name
                    break
        
        # If both latest and latest-1 folders are found, break the loop
        if latest_folder and latest_minus_1_folder:
            break

# Print the latest and latest-1 folder names
print(f"Latest folder: {latest_folder}")
print(f"Latest-1 folder: {latest_minus_1_folder}")
