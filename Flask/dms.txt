from fastapi import FastAPI, Response
import openpyxl
from openpyxl.utils import get_column_letter

app = FastAPI()

# Define the available templates
templates = {
    'template1': ['Column A', 'Column B', 'Column C', 'Column D'],
    'template2': ['Column X', 'Column Y', 'Column Z']
}

@app.get('/download-template/{template_id}')
async def download_template(template_id: str, response: Response):
    if template_id not in templates:
        return {'error': 'Template not found'}

    # Create a new workbook
    workbook = openpyxl.Workbook()

    # Get the active worksheet
    worksheet = workbook.active

    # Write the header row
    header = templates[template_id]
    for col_num, column_title in enumerate(header, start=1):
        col_letter = get_column_letter(col_num)
        worksheet[f'{col_letter}1'] = column_title

    # Save the workbook to a byte stream
    stream = BytesIO()
    workbook.save(stream)
    stream.seek(0)

    # Set the response headers
    response.headers['Content-Disposition'] = f'attachment; filename={template_id}.xlsx'
    response.headers['Content-Type'] = 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'

    # Return the Excel file as a response
    return Response(content=stream.getvalue(), media_type='application/vnd.openxmlformats-officedocument.spreadsheetml.sheet')
